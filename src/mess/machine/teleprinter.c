#include "driver.h"
#include "machine/teleprinter.h"

/***************************************************************************
    TYPE DEFINITIONS
***************************************************************************/
#define TELEPRINTER_WIDTH 80
#define TELEPRINTER_HEIGHT 25
typedef struct _teleprinter_state teleprinter_state;
struct _teleprinter_state
{
	UINT8 buffer[TELEPRINTER_WIDTH*TELEPRINTER_HEIGHT];
	UINT8 x_pos;
	UINT8 shift_state;
	UINT8 ctrl_state;
	devcb_resolved_write8 teleprinter_keyboard_func;
};

/*****************************************************************************
    INLINE FUNCTIONS
*****************************************************************************/
INLINE teleprinter_state *get_safe_token(const device_config *device)
{
	assert(device != NULL);
	assert(device->token != NULL);
	assert(device->type == GENERIC_TELEPRINTER);
	
	return (teleprinter_state *)device->token;
}

INLINE const teleprinter_interface *get_interface(const device_config *device)
{
	assert(device != NULL);
	assert(device->type == GENERIC_TELEPRINTER);
	return (const teleprinter_interface *) device->static_config;
}

/***************************************************************************
    IMPLEMENTATION
***************************************************************************/

static const UINT8 teleprinter_font[128*8] = 
{
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x07,0x07,0x07,0x07,0x00,0x00,0x00,0x00,
  0x38,0x38,0x38,0x38,0x00,0x00,0x00,0x00,
  0x3f,0x3f,0x3f,0x3f,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x07,0x07,0x07,0x07,
  0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
  0x38,0x38,0x38,0x38,0x07,0x07,0x07,0x07,
  0x3f,0x3f,0x3f,0x3f,0x07,0x07,0x07,0x07,
  0x00,0x00,0x00,0x00,0x38,0x38,0x38,0x38,
  0x07,0x07,0x07,0x07,0x38,0x38,0x38,0x38,
  0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,
  0x3f,0x3f,0x3f,0x3f,0x38,0x38,0x38,0x38,
  0x00,0x00,0x00,0x00,0x3f,0x3f,0x3f,0x3f,
  0x07,0x07,0x07,0x07,0x3f,0x3f,0x3f,0x3f,
  0x38,0x38,0x38,0x38,0x3f,0x3f,0x3f,0x3f,
  0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
  0x00,0x00,0x00,0x00,0x2a,0x15,0x2a,0x15,
  0x2a,0x15,0x2a,0x15,0x00,0x00,0x00,0x00,
  0x3f,0x3f,0x3f,0x3f,0x2a,0x15,0x2a,0x15,
  0x2a,0x15,0x2a,0x15,0x3f,0x3f,0x3f,0x3f,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x08,0x08,0x08,0x08,0x08,0x00,0x08,0x00,
  0x14,0x14,0x14,0x00,0x00,0x00,0x00,0x00,
  0x14,0x14,0x3e,0x14,0x3e,0x14,0x14,0x00,
  0x08,0x3c,0x0a,0x1c,0x28,0x1e,0x08,0x00,
  0x06,0x26,0x10,0x08,0x04,0x32,0x30,0x00,
  0x08,0x14,0x14,0x0c,0x2a,0x12,0x2c,0x00,
  0x08,0x08,0x04,0x00,0x00,0x00,0x00,0x00,
  0x10,0x08,0x04,0x04,0x04,0x08,0x10,0x00,
  0x04,0x08,0x10,0x10,0x10,0x08,0x04,0x00,
  0x00,0x08,0x2a,0x1c,0x2a,0x08,0x00,0x00,
  0x00,0x08,0x08,0x3e,0x08,0x08,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x08,0x04,0x00,
  0x00,0x00,0x00,0x3e,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,
  0x00,0x20,0x10,0x08,0x04,0x02,0x00,0x00,
  0x1c,0x22,0x32,0x2a,0x26,0x22,0x1c,0x00,
  0x08,0x0c,0x08,0x08,0x08,0x08,0x1c,0x00,
  0x1c,0x22,0x20,0x18,0x04,0x02,0x3e,0x00,
  0x3e,0x20,0x10,0x18,0x20,0x22,0x1c,0x00,
  0x10,0x18,0x14,0x12,0x3e,0x10,0x10,0x00,
  0x3e,0x02,0x1e,0x20,0x20,0x22,0x1c,0x00,
  0x10,0x08,0x04,0x1c,0x22,0x22,0x1c,0x00,
  0x3e,0x20,0x10,0x08,0x04,0x04,0x04,0x00,
  0x1c,0x22,0x22,0x1c,0x22,0x22,0x1c,0x00,
  0x1c,0x22,0x22,0x1c,0x10,0x08,0x04,0x00,
  0x00,0x00,0x00,0x08,0x00,0x08,0x00,0x00,
  0x00,0x00,0x08,0x00,0x08,0x08,0x04,0x00,
  0x10,0x08,0x04,0x02,0x04,0x08,0x10,0x00,
  0x00,0x00,0x3e,0x00,0x3e,0x00,0x00,0x00,
  0x04,0x08,0x10,0x20,0x10,0x08,0x04,0x00,
  0x1c,0x22,0x20,0x10,0x08,0x00,0x08,0x00,
  0x1c,0x22,0x32,0x2a,0x3a,0x02,0x3c,0x00,
  0x08,0x14,0x22,0x22,0x3e,0x22,0x22,0x00,
  0x1e,0x22,0x22,0x1e,0x22,0x22,0x1e,0x00,
  0x1c,0x22,0x02,0x02,0x02,0x22,0x1c,0x00,
  0x1e,0x24,0x24,0x24,0x24,0x24,0x1e,0x00,
  0x3e,0x02,0x02,0x1e,0x02,0x02,0x3e,0x00,
  0x3e,0x02,0x02,0x1e,0x02,0x02,0x02,0x00,
  0x1c,0x22,0x02,0x02,0x32,0x22,0x3c,0x00,
  0x22,0x22,0x22,0x3e,0x22,0x22,0x22,0x00,
  0x1c,0x08,0x08,0x08,0x08,0x08,0x1c,0x00,
  0x38,0x10,0x10,0x10,0x10,0x12,0x0c,0x00,
  0x22,0x12,0x0a,0x06,0x0a,0x12,0x22,0x00,
  0x02,0x02,0x02,0x02,0x02,0x02,0x3e,0x00,
  0x22,0x36,0x2a,0x2a,0x22,0x22,0x22,0x00,
  0x22,0x22,0x26,0x2a,0x32,0x22,0x22,0x00,
  0x1c,0x22,0x22,0x22,0x22,0x22,0x1c,0x00,
  0x1e,0x22,0x22,0x1e,0x02,0x02,0x02,0x00,
  0x1c,0x22,0x22,0x22,0x2a,0x12,0x2c,0x00,
  0x1e,0x22,0x22,0x1e,0x0a,0x12,0x22,0x00,
  0x1c,0x22,0x02,0x1c,0x20,0x22,0x1c,0x00,
  0x3e,0x08,0x08,0x08,0x08,0x08,0x08,0x00,
  0x22,0x22,0x22,0x22,0x22,0x22,0x1c,0x00,
  0x22,0x22,0x22,0x14,0x14,0x08,0x08,0x00,
  0x22,0x22,0x22,0x2a,0x2a,0x2a,0x14,0x00,
  0x22,0x22,0x14,0x08,0x14,0x22,0x22,0x00,
  0x22,0x22,0x22,0x14,0x08,0x08,0x08,0x00,
  0x3e,0x20,0x10,0x08,0x04,0x02,0x3e,0x00,
  0x0e,0x02,0x02,0x02,0x02,0x02,0x0e,0x00,
  0x00,0x02,0x04,0x08,0x10,0x20,0x00,0x00,
  0x38,0x20,0x20,0x20,0x20,0x20,0x38,0x00,
  0x08,0x1c,0x2a,0x08,0x08,0x08,0x08,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x3e,0x00,
  0x04,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x1c,0x20,0x3c,0x22,0x3c,0x00,
  0x02,0x02,0x1e,0x22,0x22,0x22,0x1e,0x00,
  0x00,0x00,0x3c,0x02,0x02,0x02,0x3c,0x00,
  0x20,0x20,0x3c,0x22,0x22,0x22,0x3c,0x00,
  0x00,0x00,0x1c,0x22,0x3e,0x02,0x1c,0x00,
  0x18,0x04,0x0e,0x04,0x04,0x04,0x04,0x00,
  0x00,0x00,0x3c,0x22,0x22,0x3c,0x20,0x18,
  0x02,0x02,0x1e,0x22,0x22,0x22,0x22,0x00,
  0x08,0x00,0x0c,0x08,0x08,0x08,0x1c,0x00,
  0x10,0x00,0x18,0x10,0x10,0x10,0x12,0x0c,
  0x02,0x02,0x22,0x12,0x0e,0x16,0x22,0x00,
  0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x00,
  0x00,0x00,0x16,0x2a,0x2a,0x2a,0x2a,0x00,
  0x00,0x00,0x1a,0x26,0x22,0x22,0x22,0x00,
  0x00,0x00,0x1c,0x22,0x22,0x22,0x1c,0x00,
  0x00,0x00,0x1e,0x22,0x22,0x1e,0x02,0x02,
  0x00,0x00,0x3c,0x22,0x22,0x3c,0x20,0x20,
  0x00,0x00,0x34,0x0c,0x04,0x04,0x04,0x00,
  0x00,0x00,0x3c,0x02,0x1c,0x20,0x1e,0x00,
  0x08,0x08,0x1c,0x08,0x08,0x08,0x10,0x00,
  0x00,0x00,0x22,0x22,0x22,0x32,0x2c,0x00,
  0x00,0x00,0x22,0x22,0x22,0x14,0x08,0x00,
  0x00,0x00,0x22,0x22,0x2a,0x2a,0x14,0x00,
  0x00,0x00,0x22,0x14,0x08,0x14,0x22,0x00,
  0x00,0x00,0x22,0x22,0x14,0x08,0x04,0x02,
  0x00,0x00,0x3e,0x10,0x08,0x04,0x3e,0x00,
  0x10,0x08,0x08,0x04,0x08,0x08,0x10,0x00,
  0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,
  0x04,0x08,0x08,0x10,0x08,0x08,0x04,0x00,
  0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x2a,0x15,0x2a,0x15,0x2a,0x15,0x2a,0x15 };

static void teleprinter_scroll_line(const device_config *device)
{
	teleprinter_state *term = get_safe_token(device);
	
	memcpy(term->buffer,term->buffer+TELEPRINTER_WIDTH,(TELEPRINTER_HEIGHT-1)*TELEPRINTER_WIDTH);
	memset(term->buffer + TELEPRINTER_WIDTH*(TELEPRINTER_HEIGHT-1),0,TELEPRINTER_WIDTH);
}

static void teleprinter_write_char(const device_config *device,UINT8 data) {
	teleprinter_state *term = get_safe_token(device);
	
	term->buffer[24*TELEPRINTER_WIDTH+term->x_pos] = data;
	term->x_pos++;
	if (term->x_pos > TELEPRINTER_WIDTH) {
		term->x_pos = 0;
		teleprinter_scroll_line(device);
	}
}

static void teleprinter_clear(const device_config *device) {
	teleprinter_state *term = get_safe_token(device);
	
	memset(term->buffer,0,TELEPRINTER_WIDTH*TELEPRINTER_HEIGHT);
	term->x_pos = 0;
}

WRITE8_DEVICE_HANDLER ( teleprinter_write ) 
{
	teleprinter_state *term = get_safe_token(device);
	switch(data) {
		case 10: term->x_pos = 0;
				 teleprinter_scroll_line(device);
				 break;
		case 13: term->x_pos = 0; break;
		case  9: do {
					term->x_pos ++;
				 } while ((term->x_pos % 8)!=0);
				 break;
		case 16: break;
		default: teleprinter_write_char(device,data); break;
	}
}
	
/***************************************************************************
    VIDEO HARDWARE
***************************************************************************/
void generic_teleprinter_update(const device_config *device, bitmap_t *bitmap, const rectangle *cliprect)
{
	UINT8 code;
	int y, c, x, b;
	teleprinter_state *term = get_safe_token(device);

	for (y = 0; y < TELEPRINTER_HEIGHT; y++)
	{
		for (c = 0; c < 8; c++) 
		{
			int horpos = 0;
			for (x = 0; x < TELEPRINTER_WIDTH; x++)
			{			
				code = teleprinter_font[(term->buffer[y*TELEPRINTER_WIDTH + x]  & 0x7f) *8 + c];
				for (b = 0; b < 8; b++)
				{
					*BITMAP_ADDR16(bitmap, y*8 + c, horpos++) =  (code >> b) & 0x01 ? 0 : 1;
				}
			}
		}
	}
}

static INPUT_CHANGED( teleprinter_shift )
{
	const device_config	*devconf = devtag_get_device(field->port->machine, TELEPRINTER_TAG);
	teleprinter_state *term = get_safe_token(devconf);
	term->shift_state = BIT(input_port_read(field->port->machine, "KEYSSPEC"),1);
}

static INPUT_CHANGED( teleprinter_ctrl )
{
	const device_config	*devconf = devtag_get_device(field->port->machine, TELEPRINTER_TAG);
	teleprinter_state *term = get_safe_token(devconf);
	term->ctrl_state = BIT(input_port_read(field->port->machine, "KEYSSPEC"),0);
}
// Ugh, god, this is a horrible, HORRIBLE hack!
static INPUT_CHANGED( teleprinter_kbd_put )
{
	const device_config	*devconf = devtag_get_device(field->port->machine, TELEPRINTER_TAG);
	teleprinter_state *term = get_safe_token(devconf);
	UINT8 data = (UINT8)(FPTR)param;
	if(input_port_read(field->port->machine, "KEYS0") ||
	   input_port_read(field->port->machine, "KEYS1") ||
	   input_port_read(field->port->machine, "KEYS2") ||
	   input_port_read(field->port->machine, "KEYS3") ||
	   input_port_read(field->port->machine, "KEYS4"))
	{		
		if (term->ctrl_state==1) {
			data -= 0x60;
		}
		if (term->shift_state==1) {
			data -= 0x20;
		} 
		
		devcb_call_write8(&term->teleprinter_keyboard_func, 0, data);
	}
}

/***************************************************************************
    VIDEO HARDWARE
***************************************************************************/
static VIDEO_START( teleprinter )
{
	
}

static VIDEO_UPDATE(teleprinter )
{
	const device_config	*devconf = devtag_get_device(screen->machine, TELEPRINTER_TAG);
	generic_teleprinter_update( devconf, bitmap, cliprect);
	return 0;
}

MACHINE_DRIVER_START( generic_teleprinter )
	MDRV_SCREEN_ADD(TELEPRINTER_SCREEN_TAG, RASTER)
    MDRV_SCREEN_REFRESH_RATE(50)
    MDRV_SCREEN_VBLANK_TIME(ATTOSECONDS_IN_USEC(2500)) /* not accurate */
    MDRV_SCREEN_FORMAT(BITMAP_FORMAT_INDEXED16)
	MDRV_SCREEN_SIZE(TELEPRINTER_WIDTH*8, TELEPRINTER_HEIGHT*8)
	MDRV_SCREEN_VISIBLE_AREA(0, TELEPRINTER_WIDTH*8-1, 0, TELEPRINTER_HEIGHT*8-1)
	MDRV_PALETTE_LENGTH(2)
    MDRV_PALETTE_INIT(black_and_white)
	
	MDRV_VIDEO_START(teleprinter)
	MDRV_VIDEO_UPDATE(teleprinter)	
MACHINE_DRIVER_END


/*-------------------------------------------------
    DEVICE_START( teleprinter )
-------------------------------------------------*/

static DEVICE_START( teleprinter )
{
	teleprinter_state *term = get_safe_token(device);
	const teleprinter_interface *intf = get_interface(device);
	
	devcb_resolve_write8(&term->teleprinter_keyboard_func, &intf->teleprinter_keyboard_func, device);	
}

/*-------------------------------------------------
    DEVICE_RESET( teleprinter )
-------------------------------------------------*/

static DEVICE_RESET( teleprinter )
{
	teleprinter_state *term = get_safe_token(device);
	
	teleprinter_clear(device);
	term->shift_state = 0;
	term->ctrl_state = 0;
}

/*-------------------------------------------------
    DEVICE_GET_INFO( teleprinter )
-------------------------------------------------*/

DEVICE_GET_INFO( teleprinter )
{
	switch (state)
	{
		/* --- the following bits of info are returned as 64-bit signed integers --- */
		case DEVINFO_INT_INLINE_CONFIG_BYTES:			info->i = 0;												break;
		case DEVINFO_INT_TOKEN_BYTES:					info->i = sizeof(teleprinter_state);							break;
		case DEVINFO_INT_CLASS:							info->i = DEVICE_CLASS_PERIPHERAL;							break;

		/* --- the following bits of info are returned as pointers to data or functions --- */
		case DEVINFO_FCT_START:							info->start = DEVICE_START_NAME(teleprinter);					break;
		case DEVINFO_FCT_STOP:							/* Nothing */												break;
		case DEVINFO_FCT_RESET:							info->reset = DEVICE_RESET_NAME(teleprinter);					break;

		/* --- the following bits of info are returned as NULL-terminated strings --- */
		case DEVINFO_STR_NAME:							strcpy(info->s, "Generic Teleprinter");						break;
		case DEVINFO_STR_FAMILY:						strcpy(info->s, "Teleprinter");								break;
		case DEVINFO_STR_VERSION:						strcpy(info->s, "1.0");										break;
		case DEVINFO_STR_SOURCE_FILE:					strcpy(info->s, __FILE__);									break;
		case DEVINFO_STR_CREDITS:						strcpy(info->s, "Copyright the MESS Team"); 				break;
	}
}

INPUT_PORTS_START( generic_teleprinter )
	PORT_START("KEYS0")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_A) PORT_CHAR('a') PORT_CHAR('A')	PORT_CHANGED(teleprinter_kbd_put, (void*)'a')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_B) PORT_CHAR('b') PORT_CHAR('B')	PORT_CHANGED(teleprinter_kbd_put, (void*)'b')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_C) PORT_CHAR('c') PORT_CHAR('C')	PORT_CHANGED(teleprinter_kbd_put, (void*)'c')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_D) PORT_CHAR('d') PORT_CHAR('D')	PORT_CHANGED(teleprinter_kbd_put, (void*)'d')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_E) PORT_CHAR('e') PORT_CHAR('E')	PORT_CHANGED(teleprinter_kbd_put, (void*)'e')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_F) PORT_CHAR('f') PORT_CHAR('F')	PORT_CHANGED(teleprinter_kbd_put, (void*)'f')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_G) PORT_CHAR('g') PORT_CHAR('G')	PORT_CHANGED(teleprinter_kbd_put, (void*)'g')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_H) PORT_CHAR('h') PORT_CHAR('H')	PORT_CHANGED(teleprinter_kbd_put, (void*)'h')

	PORT_START("KEYS1")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_I) PORT_CHAR('i') PORT_CHAR('I')	PORT_CHANGED(teleprinter_kbd_put, (void*)'i')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_J) PORT_CHAR('j') PORT_CHAR('J')	PORT_CHANGED(teleprinter_kbd_put, (void*)'j')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_K) PORT_CHAR('k') PORT_CHAR('K')	PORT_CHANGED(teleprinter_kbd_put, (void*)'k')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_L) PORT_CHAR('l') PORT_CHAR('L')	PORT_CHANGED(teleprinter_kbd_put, (void*)'l')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_M) PORT_CHAR('m') PORT_CHAR('M')	PORT_CHANGED(teleprinter_kbd_put, (void*)'m')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_N) PORT_CHAR('n') PORT_CHAR('N')	PORT_CHANGED(teleprinter_kbd_put, (void*)'n')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_O) PORT_CHAR('o') PORT_CHAR('O')	PORT_CHANGED(teleprinter_kbd_put, (void*)'o')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_P) PORT_CHAR('p') PORT_CHAR('P')	PORT_CHANGED(teleprinter_kbd_put, (void*)'p')

	PORT_START("KEYS2")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Q) PORT_CHAR('q') PORT_CHAR('Q')	PORT_CHANGED(teleprinter_kbd_put, (void*)'q')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_R) PORT_CHAR('r') PORT_CHAR('R')	PORT_CHANGED(teleprinter_kbd_put, (void*)'r')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_S) PORT_CHAR('s') PORT_CHAR('S')	PORT_CHANGED(teleprinter_kbd_put, (void*)'s')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_T) PORT_CHAR('t') PORT_CHAR('T')	PORT_CHANGED(teleprinter_kbd_put, (void*)'t')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_U) PORT_CHAR('u') PORT_CHAR('U')	PORT_CHANGED(teleprinter_kbd_put, (void*)'u')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_V) PORT_CHAR('v') PORT_CHAR('V')	PORT_CHANGED(teleprinter_kbd_put, (void*)'v')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_W) PORT_CHAR('w') PORT_CHAR('W')	PORT_CHANGED(teleprinter_kbd_put, (void*)'w')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_X) PORT_CHAR('x') PORT_CHAR('X')	PORT_CHANGED(teleprinter_kbd_put, (void*)'x')

	PORT_START("KEYS3")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Y) PORT_CHAR('y') PORT_CHAR('Y')	PORT_CHANGED(teleprinter_kbd_put, (void*)'y')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Z) PORT_CHAR('z') PORT_CHAR('Z')	PORT_CHANGED(teleprinter_kbd_put, (void*)'z')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_0) PORT_CHAR('0')				PORT_CHANGED(teleprinter_kbd_put, (void*)'0')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_1) PORT_CHAR('1')				PORT_CHANGED(teleprinter_kbd_put, (void*)'1')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_2) PORT_CHAR('2')				PORT_CHANGED(teleprinter_kbd_put, (void*)'2')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_3) PORT_CHAR('3')				PORT_CHANGED(teleprinter_kbd_put, (void*)'3')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_4) PORT_CHAR('4')				PORT_CHANGED(teleprinter_kbd_put, (void*)'4')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_5) PORT_CHAR('5')				PORT_CHANGED(teleprinter_kbd_put, (void*)'5')

	PORT_START("KEYS4")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_6) PORT_CHAR('6')				PORT_CHANGED(teleprinter_kbd_put, (void*)'6')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_7) PORT_CHAR('7')				PORT_CHANGED(teleprinter_kbd_put, (void*)'7')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_8) PORT_CHAR('8')				PORT_CHANGED(teleprinter_kbd_put, (void*)'8')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_9) PORT_CHAR('9')				PORT_CHANGED(teleprinter_kbd_put, (void*)'9')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_COMMA) PORT_CHAR(',') PORT_CHAR('<') PORT_CHANGED(teleprinter_kbd_put, (void*)',')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_STOP) PORT_CHAR('.') PORT_CHAR('>') PORT_CHANGED(teleprinter_kbd_put, (void*)'.')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_SPACE) PORT_CHAR(' ')			PORT_CHANGED(teleprinter_kbd_put, (void*)' ')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_ENTER) PORT_CHAR(0x0d)			PORT_CHANGED(teleprinter_kbd_put, (void*)0x0d)
	PORT_START("KEYSSPEC")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_LCONTROL) PORT_CODE(KEYCODE_RCONTROL) PORT_CHAR(UCHAR_MAMEKEY(LCONTROL)) PORT_CHAR(UCHAR_MAMEKEY(RCONTROL)) 	PORT_CHANGED(teleprinter_ctrl, NULL)
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_LSHIFT) PORT_CODE(KEYCODE_RSHIFT) PORT_CHAR(UCHAR_SHIFT_1) 				PORT_CHANGED(teleprinter_shift, NULL)
	PORT_BIT(0xFC, IP_ACTIVE_HIGH, IPT_UNUSED) 
	
INPUT_PORTS_END
