/***************************************************************************

    Driver for Epoch Super Cassette Vision


***************************************************************************/

#include "driver.h"
#include "cpu/upd7810/upd7810.h"
#include "devices/cartslot.h"


static READ8_HANDLER( scv_porta_r );
static WRITE8_HANDLER( scv_porta_w );
static READ8_HANDLER( scv_portb_r );
static READ8_HANDLER( scv_portc_r );
static WRITE8_HANDLER( scv_portc_w );


static UINT8 *scv_vram;
static UINT8 scv_porta;
static UINT8 scv_portc;


static ADDRESS_MAP_START( scv_mem, ADDRESS_SPACE_PROGRAM, 8 )
	AM_RANGE( 0x0000, 0x0fff ) AM_ROM		/* BIOS */

	AM_RANGE( 0x2000, 0x33ff ) AM_RAM AM_BASE( &scv_vram )

	AM_RANGE( 0x8000, 0xff7f ) AM_ROM AM_REGION("cart", 0)
	AM_RANGE( 0xff80, 0xffff ) AM_RAM		/* upd7801 internal RAM */
ADDRESS_MAP_END


static ADDRESS_MAP_START( scv_io, ADDRESS_SPACE_IO, 8 )
	AM_RANGE( 0x00, 0x00 ) AM_READWRITE( scv_porta_r, scv_porta_w )
	AM_RANGE( 0x01, 0x01 ) AM_READ( scv_portb_r )
	AM_RANGE( 0x02, 0x02 ) AM_READWRITE( scv_portc_r, scv_portc_w )
ADDRESS_MAP_END


static INPUT_PORTS_START( scv )
	PORT_START( "PA0" )
	PORT_BIT( 0x01, IP_ACTIVE_LOW, IPT_JOYSTICK_LEFT ) PORT_PLAYER(1) PORT_8WAY
	PORT_BIT( 0x02, IP_ACTIVE_LOW, IPT_JOYSTICK_UP ) PORT_PLAYER(1) PORT_8WAY
	PORT_BIT( 0x04, IP_ACTIVE_LOW, IPT_BUTTON1 ) PORT_PLAYER(1)
	PORT_BIT( 0x08, IP_ACTIVE_LOW, IPT_JOYSTICK_LEFT ) PORT_PLAYER(2) PORT_8WAY
	PORT_BIT( 0x10, IP_ACTIVE_LOW, IPT_JOYSTICK_UP ) PORT_PLAYER(2) PORT_8WAY
	PORT_BIT( 0x20, IP_ACTIVE_LOW, IPT_BUTTON1 ) PORT_PLAYER(2) 

	PORT_START( "PA1" )
	PORT_BIT( 0x01, IP_ACTIVE_LOW, IPT_JOYSTICK_DOWN ) PORT_PLAYER(1) PORT_8WAY
	PORT_BIT( 0x02, IP_ACTIVE_LOW, IPT_JOYSTICK_RIGHT ) PORT_PLAYER(1) PORT_8WAY
	PORT_BIT( 0x04, IP_ACTIVE_LOW, IPT_BUTTON2 ) PORT_PLAYER(1)
	PORT_BIT( 0x08, IP_ACTIVE_LOW, IPT_JOYSTICK_DOWN ) PORT_PLAYER(2) PORT_8WAY
	PORT_BIT( 0x10, IP_ACTIVE_LOW, IPT_JOYSTICK_RIGHT ) PORT_PLAYER(2) PORT_8WAY
	PORT_BIT( 0x20, IP_ACTIVE_LOW, IPT_BUTTON2 ) PORT_PLAYER(2)

	PORT_START( "PA2" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("0") PORT_CODE(KEYCODE_0)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("1") PORT_CODE(KEYCODE_1)

	PORT_START( "PA3" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("2") PORT_CODE(KEYCODE_2)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("3") PORT_CODE(KEYCODE_3)

	PORT_START( "PA4" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("4") PORT_CODE(KEYCODE_4)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("5") PORT_CODE(KEYCODE_5)

	PORT_START( "PA5" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("6") PORT_CODE(KEYCODE_6)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("7") PORT_CODE(KEYCODE_7)

	PORT_START( "PA6" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("8") PORT_CODE(KEYCODE_8)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("9") PORT_CODE(KEYCODE_9)

	PORT_START( "PA7" )
	PORT_BIT( 0x40, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("Cl") PORT_CODE(KEYCODE_BACKSPACE)
	PORT_BIT( 0x80, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME("En") PORT_CODE(KEYCODE_ENTER)

	PORT_START( "PC0" )
	PORT_BIT( 0x01, IP_ACTIVE_LOW, IPT_KEYBOARD ) PORT_NAME(DEF_STR(Pause)) PORT_CODE(KEYCODE_O)
INPUT_PORTS_END


static READ8_HANDLER( scv_porta_r )
{
	return 0xff;
}


static WRITE8_HANDLER( scv_porta_w )
{
	scv_porta = data;
}

static READ8_HANDLER( scv_portb_r )
{
	return 0xff;
}


static READ8_HANDLER( scv_portc_r )
{
	return 0xff;
}


static WRITE8_HANDLER( scv_portc_w )
{
	scv_portc = data;
}


static DEVICE_IMAGE_LOAD( scv_cart )
{

	UINT8 *cart = memory_region( image->machine, "cart" );
	int size = image_length( image );

	if ( size > 0x8000 )
	{
		image_seterror( image, IMAGE_ERROR_UNSPECIFIED, "Unsupported cartridge size" );
		return INIT_FAIL;
	}

	if ( image_fread( image, cart, size ) != size )
	{
		image_seterror( image, IMAGE_ERROR_UNSPECIFIED, "Unable to fully read from file" );
		return INIT_FAIL;
	}

	return INIT_PASS;
}


static const UPD7810_CONFIG scv_cpu_config = { TYPE_7801, NULL };


static MACHINE_DRIVER_START( scv )
	MDRV_CPU_ADD( "maincpu", UPD7801, XTAL_4MHz )
	MDRV_CPU_PROGRAM_MAP( scv_mem )
	MDRV_CPU_IO_MAP( scv_io )
	MDRV_CPU_CONFIG( scv_cpu_config )

	MDRV_SCREEN_ADD( "screen", RASTER )
	MDRV_SCREEN_FORMAT( BITMAP_FORMAT_INDEXED16 )
	MDRV_SCREEN_RAW_PARAMS( XTAL_14_31818MHz/2, 456, 0, 256, 262, 0, 200 )	/* TODO: Verify */

	MDRV_PALETTE_LENGTH(16)

	/* Video chip is EPOCH TV-1 */

	/* Sound is generated by UPD1771C clocked at XTAL_6MHz */

	MDRV_CARTSLOT_ADD( "cart" )
	MDRV_CARTSLOT_EXTENSION_LIST( "bin" )
	MDRV_CARTSLOT_NOT_MANDATORY
	MDRV_CARTSLOT_LOAD( scv_cart )
MACHINE_DRIVER_END


static MACHINE_DRIVER_START( scv_pal )
	MDRV_CPU_ADD( "maincpu", UPD7801, 3780000 ) 
	MDRV_CPU_PROGRAM_MAP( scv_mem )
	MDRV_CPU_IO_MAP( scv_io )
	MDRV_CPU_CONFIG( scv_cpu_config )

	MDRV_SCREEN_ADD( "screen", RASTER )
	MDRV_SCREEN_FORMAT( BITMAP_FORMAT_INDEXED16 )
	MDRV_SCREEN_RAW_PARAMS( XTAL_13_4MHz/2, 456, 0, 256, 342, 0, 200 )		/* TODO: Verify */

	MDRV_PALETTE_LENGTH(16)

	/* Video chip is EPOCH TV-1A */

	/* Sound is generated by UPD1771C clocked at XTAL_6MHz */
	MDRV_CARTSLOT_ADD( "cart" )
	MDRV_CARTSLOT_EXTENSION_LIST( "bin" )
	MDRV_CARTSLOT_NOT_MANDATORY
	MDRV_CARTSLOT_LOAD( scv_cart )
MACHINE_DRIVER_END


/* The same bios is used in both the NTSC and PAL versions of the console */
ROM_START( scv )
	ROM_REGION( 0x1000, "maincpu", 0 )
	ROM_LOAD( "upd7801g.s01", 0, 0x1000, CRC(7ac06182) SHA1(6e89d1227581c76441a53d605f9e324185f1da33) )

	ROM_REGION( 0x8000, "cart", ROMREGION_ERASEFF )
ROM_END


ROM_START( scv_pal )
	ROM_REGION( 0x1000, "maincpu", 0 )
	ROM_LOAD( "upd7801g.s01", 0, 0x1000, CRC(7ac06182) SHA1(6e89d1227581c76441a53d605f9e324185f1da33) )

	ROM_REGION( 0x8000, "cart", ROMREGION_ERASEFF )
ROM_END


/*    YEAR  NAME     PARENT  COMPAT  MACHINE  INPUT  INIT    COMPANY  FULLNAME                 FLAGS */
CONS( 199?, scv,     0,      0,      scv,     scv,   0,      "Epoch", "Super Cassette Vision", GAME_NOT_WORKING )
CONS( 199?, scv_pal, scv,    0,      scv_pal, scv,   0,      "Epoch", "Super Cassette Vision (PAL)", GAME_NOT_WORKING )

