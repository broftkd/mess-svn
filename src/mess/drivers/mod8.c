/***************************************************************************

		Microsystems International Limited MOD-8

        18/11/2009 Skeleton driver.

****************************************************************************/

#include "driver.h"
#include "cpu/i8008/i8008.h"

static UINT8 tty_buffer[80*25];

static const UINT8 teleprinter_font[128*8] = {
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x07,0x07,0x07,0x07,0x00,0x00,0x00,0x00,
  0x38,0x38,0x38,0x38,0x00,0x00,0x00,0x00,
  0x3f,0x3f,0x3f,0x3f,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x07,0x07,0x07,0x07,
  0x07,0x07,0x07,0x07,0x07,0x07,0x07,0x07,
  0x38,0x38,0x38,0x38,0x07,0x07,0x07,0x07,
  0x3f,0x3f,0x3f,0x3f,0x07,0x07,0x07,0x07,
  0x00,0x00,0x00,0x00,0x38,0x38,0x38,0x38,
  0x07,0x07,0x07,0x07,0x38,0x38,0x38,0x38,
  0x38,0x38,0x38,0x38,0x38,0x38,0x38,0x38,
  0x3f,0x3f,0x3f,0x3f,0x38,0x38,0x38,0x38,
  0x00,0x00,0x00,0x00,0x3f,0x3f,0x3f,0x3f,
  0x07,0x07,0x07,0x07,0x3f,0x3f,0x3f,0x3f,
  0x38,0x38,0x38,0x38,0x3f,0x3f,0x3f,0x3f,
  0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,0x3f,
  0x00,0x00,0x00,0x00,0x2a,0x15,0x2a,0x15,
  0x2a,0x15,0x2a,0x15,0x00,0x00,0x00,0x00,
  0x3f,0x3f,0x3f,0x3f,0x2a,0x15,0x2a,0x15,
  0x2a,0x15,0x2a,0x15,0x3f,0x3f,0x3f,0x3f,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x08,0x08,0x08,0x08,0x08,0x00,0x08,0x00,
  0x14,0x14,0x14,0x00,0x00,0x00,0x00,0x00,
  0x14,0x14,0x3e,0x14,0x3e,0x14,0x14,0x00,
  0x08,0x3c,0x0a,0x1c,0x28,0x1e,0x08,0x00,
  0x06,0x26,0x10,0x08,0x04,0x32,0x30,0x00,
  0x08,0x14,0x14,0x0c,0x2a,0x12,0x2c,0x00,
  0x08,0x08,0x04,0x00,0x00,0x00,0x00,0x00,
  0x10,0x08,0x04,0x04,0x04,0x08,0x10,0x00,
  0x04,0x08,0x10,0x10,0x10,0x08,0x04,0x00,
  0x00,0x08,0x2a,0x1c,0x2a,0x08,0x00,0x00,
  0x00,0x08,0x08,0x3e,0x08,0x08,0x00,0x00,
  0x00,0x00,0x00,0x00,0x08,0x08,0x04,0x00,
  0x00,0x00,0x00,0x3e,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,
  0x00,0x20,0x10,0x08,0x04,0x02,0x00,0x00,
  0x1c,0x22,0x32,0x2a,0x26,0x22,0x1c,0x00,
  0x08,0x0c,0x08,0x08,0x08,0x08,0x1c,0x00,
  0x1c,0x22,0x20,0x18,0x04,0x02,0x3e,0x00,
  0x3e,0x20,0x10,0x18,0x20,0x22,0x1c,0x00,
  0x10,0x18,0x14,0x12,0x3e,0x10,0x10,0x00,
  0x3e,0x02,0x1e,0x20,0x20,0x22,0x1c,0x00,
  0x10,0x08,0x04,0x1c,0x22,0x22,0x1c,0x00,
  0x3e,0x20,0x10,0x08,0x04,0x04,0x04,0x00,
  0x1c,0x22,0x22,0x1c,0x22,0x22,0x1c,0x00,
  0x1c,0x22,0x22,0x1c,0x10,0x08,0x04,0x00,
  0x00,0x00,0x00,0x08,0x00,0x08,0x00,0x00,
  0x00,0x00,0x08,0x00,0x08,0x08,0x04,0x00,
  0x10,0x08,0x04,0x02,0x04,0x08,0x10,0x00,
  0x00,0x00,0x3e,0x00,0x3e,0x00,0x00,0x00,
  0x04,0x08,0x10,0x20,0x10,0x08,0x04,0x00,
  0x1c,0x22,0x20,0x10,0x08,0x00,0x08,0x00,
  0x1c,0x22,0x32,0x2a,0x3a,0x02,0x3c,0x00,
  0x08,0x14,0x22,0x22,0x3e,0x22,0x22,0x00,
  0x1e,0x22,0x22,0x1e,0x22,0x22,0x1e,0x00,
  0x1c,0x22,0x02,0x02,0x02,0x22,0x1c,0x00,
  0x1e,0x24,0x24,0x24,0x24,0x24,0x1e,0x00,
  0x3e,0x02,0x02,0x1e,0x02,0x02,0x3e,0x00,
  0x3e,0x02,0x02,0x1e,0x02,0x02,0x02,0x00,
  0x1c,0x22,0x02,0x02,0x32,0x22,0x3c,0x00,
  0x22,0x22,0x22,0x3e,0x22,0x22,0x22,0x00,
  0x1c,0x08,0x08,0x08,0x08,0x08,0x1c,0x00,
  0x38,0x10,0x10,0x10,0x10,0x12,0x0c,0x00,
  0x22,0x12,0x0a,0x06,0x0a,0x12,0x22,0x00,
  0x02,0x02,0x02,0x02,0x02,0x02,0x3e,0x00,
  0x22,0x36,0x2a,0x2a,0x22,0x22,0x22,0x00,
  0x22,0x22,0x26,0x2a,0x32,0x22,0x22,0x00,
  0x1c,0x22,0x22,0x22,0x22,0x22,0x1c,0x00,
  0x1e,0x22,0x22,0x1e,0x02,0x02,0x02,0x00,
  0x1c,0x22,0x22,0x22,0x2a,0x12,0x2c,0x00,
  0x1e,0x22,0x22,0x1e,0x0a,0x12,0x22,0x00,
  0x1c,0x22,0x02,0x1c,0x20,0x22,0x1c,0x00,
  0x3e,0x08,0x08,0x08,0x08,0x08,0x08,0x00,
  0x22,0x22,0x22,0x22,0x22,0x22,0x1c,0x00,
  0x22,0x22,0x22,0x14,0x14,0x08,0x08,0x00,
  0x22,0x22,0x22,0x2a,0x2a,0x2a,0x14,0x00,
  0x22,0x22,0x14,0x08,0x14,0x22,0x22,0x00,
  0x22,0x22,0x22,0x14,0x08,0x08,0x08,0x00,
  0x3e,0x20,0x10,0x08,0x04,0x02,0x3e,0x00,
  0x0e,0x02,0x02,0x02,0x02,0x02,0x0e,0x00,
  0x00,0x02,0x04,0x08,0x10,0x20,0x00,0x00,
  0x38,0x20,0x20,0x20,0x20,0x20,0x38,0x00,
  0x08,0x1c,0x2a,0x08,0x08,0x08,0x08,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x3e,0x00,
  0x04,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x1c,0x20,0x3c,0x22,0x3c,0x00,
  0x02,0x02,0x1e,0x22,0x22,0x22,0x1e,0x00,
  0x00,0x00,0x3c,0x02,0x02,0x02,0x3c,0x00,
  0x20,0x20,0x3c,0x22,0x22,0x22,0x3c,0x00,
  0x00,0x00,0x1c,0x22,0x3e,0x02,0x1c,0x00,
  0x18,0x04,0x0e,0x04,0x04,0x04,0x04,0x00,
  0x00,0x00,0x3c,0x22,0x22,0x3c,0x20,0x18,
  0x02,0x02,0x1e,0x22,0x22,0x22,0x22,0x00,
  0x08,0x00,0x0c,0x08,0x08,0x08,0x1c,0x00,
  0x10,0x00,0x18,0x10,0x10,0x10,0x12,0x0c,
  0x02,0x02,0x22,0x12,0x0e,0x16,0x22,0x00,
  0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x00,
  0x00,0x00,0x16,0x2a,0x2a,0x2a,0x2a,0x00,
  0x00,0x00,0x1a,0x26,0x22,0x22,0x22,0x00,
  0x00,0x00,0x1c,0x22,0x22,0x22,0x1c,0x00,
  0x00,0x00,0x1e,0x22,0x22,0x1e,0x02,0x02,
  0x00,0x00,0x3c,0x22,0x22,0x3c,0x20,0x20,
  0x00,0x00,0x34,0x0c,0x04,0x04,0x04,0x00,
  0x00,0x00,0x3c,0x02,0x1c,0x20,0x1e,0x00,
  0x08,0x08,0x1c,0x08,0x08,0x08,0x10,0x00,
  0x00,0x00,0x22,0x22,0x22,0x32,0x2c,0x00,
  0x00,0x00,0x22,0x22,0x22,0x14,0x08,0x00,
  0x00,0x00,0x22,0x22,0x2a,0x2a,0x14,0x00,
  0x00,0x00,0x22,0x14,0x08,0x14,0x22,0x00,
  0x00,0x00,0x22,0x22,0x14,0x08,0x04,0x02,
  0x00,0x00,0x3e,0x10,0x08,0x04,0x3e,0x00,
  0x10,0x08,0x08,0x04,0x08,0x08,0x10,0x00,
  0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x00,
  0x04,0x08,0x08,0x10,0x08,0x08,0x04,0x00,
  0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x2a,0x15,0x2a,0x15,0x2a,0x15,0x2a,0x15 };
 
	
static UINT16 tty_data;
static UINT8 tty_key_data;
static int tty_cnt  = 0;

static int tty_x_pos;

static void tty_scroll_line(void)
{
	memcpy(tty_buffer,tty_buffer+80,24*80);
	memset(tty_buffer + 80*24,0,80);
}

static void tty_write_char(UINT8 data) {
	tty_buffer[24*80+tty_x_pos] = data;
	tty_x_pos++;
	if (tty_x_pos > 80) {
		tty_x_pos = 0;
		tty_scroll_line();
	}
}

static void tty_clear(void) {
	memset(tty_buffer,0,80*25);
	tty_x_pos = 0;
}

static void tty_write(UINT8 data) {
	switch(data) {
		case 10: tty_scroll_line(); break;
		case 13: tty_x_pos = 0; break;
		default: tty_write_char(data); break;
	}
}
static WRITE8_HANDLER(out_w)
{
	tty_data >>= 1;
	tty_data |= (data & 0x01) ? 0x8000 : 0;
	tty_cnt++;
	if (tty_cnt==10) {
		tty_write((tty_data >> 7) & 0x7f);
		tty_cnt = 0;
	}
}

static WRITE8_HANDLER(tty_w)
{
	tty_data = 0;
	tty_cnt = 0;		
}

static READ8_HANDLER(tty_r)
{
	UINT8 d = tty_key_data & 0x01;
	tty_key_data >>= 1;
	return d;
}

static INPUT_CHANGED( tty_kbd_put )
{
	if(input_port_read(field->port->machine, "KEYS0") ||
	   input_port_read(field->port->machine, "KEYS1") ||
	   input_port_read(field->port->machine, "KEYS2") ||
	   input_port_read(field->port->machine, "KEYS3") ||
	   input_port_read(field->port->machine, "KEYS4"))
	{
		tty_key_data = ((((UINT8)(FPTR)param))) ^ 0xff;
		cputag_set_input_line(field->port->machine, "maincpu", 0, HOLD_LINE);
	} else {
		cputag_set_input_line(field->port->machine, "maincpu", 0, CLEAR_LINE);
	}
}

static ADDRESS_MAP_START(mod8_mem, ADDRESS_SPACE_PROGRAM, 8)
	ADDRESS_MAP_UNMAP_HIGH
	AM_RANGE(0x000,0x6ff) AM_ROM
	AM_RANGE(0x700,0xfff) AM_RAM
ADDRESS_MAP_END

static ADDRESS_MAP_START( mod8_io , ADDRESS_SPACE_IO, 8)
	ADDRESS_MAP_UNMAP_HIGH
	AM_RANGE(0x00,0x00) AM_READ(tty_r)
	AM_RANGE(0x0a,0x0a) AM_WRITE(out_w)
	AM_RANGE(0x0b,0x0b) AM_WRITE(tty_w)
ADDRESS_MAP_END

/* Input ports */
static INPUT_PORTS_START( mod8 )
	PORT_START("KEYS0")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_A) PORT_CHAR('a') PORT_CHAR('A')	PORT_CHANGED(tty_kbd_put, (void*)'A')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_B) PORT_CHAR('b') PORT_CHAR('B')	PORT_CHANGED(tty_kbd_put, (void*)'B')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_C) PORT_CHAR('c') PORT_CHAR('C')	PORT_CHANGED(tty_kbd_put, (void*)'C')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_D) PORT_CHAR('d') PORT_CHAR('D')	PORT_CHANGED(tty_kbd_put, (void*)'D')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_E) PORT_CHAR('e') PORT_CHAR('E')	PORT_CHANGED(tty_kbd_put, (void*)'E')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_F) PORT_CHAR('f') PORT_CHAR('F')	PORT_CHANGED(tty_kbd_put, (void*)'F')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_G) PORT_CHAR('g') PORT_CHAR('G')	PORT_CHANGED(tty_kbd_put, (void*)'G')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_H) PORT_CHAR('h') PORT_CHAR('H')	PORT_CHANGED(tty_kbd_put, (void*)'H')

	PORT_START("KEYS1")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_I) PORT_CHAR('i') PORT_CHAR('I')	PORT_CHANGED(tty_kbd_put, (void*)'I')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_J) PORT_CHAR('j') PORT_CHAR('J')	PORT_CHANGED(tty_kbd_put, (void*)'J')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_K) PORT_CHAR('k') PORT_CHAR('K')	PORT_CHANGED(tty_kbd_put, (void*)'K')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_L) PORT_CHAR('l') PORT_CHAR('L')	PORT_CHANGED(tty_kbd_put, (void*)'L')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_M) PORT_CHAR('m') PORT_CHAR('M')	PORT_CHANGED(tty_kbd_put, (void*)'M')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_N) PORT_CHAR('n') PORT_CHAR('N')	PORT_CHANGED(tty_kbd_put, (void*)'N')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_O) PORT_CHAR('o') PORT_CHAR('O')	PORT_CHANGED(tty_kbd_put, (void*)'O')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_P) PORT_CHAR('p') PORT_CHAR('P')	PORT_CHANGED(tty_kbd_put, (void*)'P')

	PORT_START("KEYS2")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Q) PORT_CHAR('q') PORT_CHAR('Q')	PORT_CHANGED(tty_kbd_put, (void*)'Q')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_R) PORT_CHAR('r') PORT_CHAR('R')	PORT_CHANGED(tty_kbd_put, (void*)'R')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_S) PORT_CHAR('s') PORT_CHAR('S')	PORT_CHANGED(tty_kbd_put, (void*)'S')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_T) PORT_CHAR('t') PORT_CHAR('T')	PORT_CHANGED(tty_kbd_put, (void*)'T')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_U) PORT_CHAR('u') PORT_CHAR('U')	PORT_CHANGED(tty_kbd_put, (void*)'U')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_V) PORT_CHAR('v') PORT_CHAR('V')	PORT_CHANGED(tty_kbd_put, (void*)'V')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_W) PORT_CHAR('w') PORT_CHAR('W')	PORT_CHANGED(tty_kbd_put, (void*)'W')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_X) PORT_CHAR('x') PORT_CHAR('X')	PORT_CHANGED(tty_kbd_put, (void*)'X')

	PORT_START("KEYS3")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Y) PORT_CHAR('y') PORT_CHAR('Y')	PORT_CHANGED(tty_kbd_put, (void*)'Y')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_Z) PORT_CHAR('z') PORT_CHAR('Z')	PORT_CHANGED(tty_kbd_put, (void*)'Z')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_0) PORT_CHAR('0')				PORT_CHANGED(tty_kbd_put, (void*)'0')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_1) PORT_CHAR('1')				PORT_CHANGED(tty_kbd_put, (void*)'1')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_2) PORT_CHAR('2')				PORT_CHANGED(tty_kbd_put, (void*)'2')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_3) PORT_CHAR('3')				PORT_CHANGED(tty_kbd_put, (void*)'3')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_4) PORT_CHAR('4')				PORT_CHANGED(tty_kbd_put, (void*)'4')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_5) PORT_CHAR('5')				PORT_CHANGED(tty_kbd_put, (void*)'5')

	PORT_START("KEYS4")
	PORT_BIT(0x01, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_6) PORT_CHAR('6')				PORT_CHANGED(tty_kbd_put, (void*)'6')
	PORT_BIT(0x02, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_7) PORT_CHAR('7')				PORT_CHANGED(tty_kbd_put, (void*)'7')
	PORT_BIT(0x04, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_8) PORT_CHAR('8')				PORT_CHANGED(tty_kbd_put, (void*)'8')
	PORT_BIT(0x08, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_9) PORT_CHAR('9')				PORT_CHANGED(tty_kbd_put, (void*)'9')
	PORT_BIT(0x10, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_COMMA) PORT_CHAR(',') PORT_CHAR('<') PORT_CHANGED(tty_kbd_put, (void*)',')
	PORT_BIT(0x20, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_STOP) PORT_CHAR('.') PORT_CHAR('>') PORT_CHANGED(tty_kbd_put, (void*)'.')
	PORT_BIT(0x40, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_SPACE) PORT_CHAR(' ')			PORT_CHANGED(tty_kbd_put, (void*)' ')
	PORT_BIT(0x80, IP_ACTIVE_HIGH, IPT_KEYBOARD) PORT_CODE(KEYCODE_ENTER) PORT_CHAR(0x0a)			PORT_CHANGED(tty_kbd_put, (void*)0x0a)
INPUT_PORTS_END

static IRQ_CALLBACK ( mod8_irq_callback )
{
	return 0xC0; // LAA - NOP equivalent
}

static MACHINE_RESET(mod8)
{
	cpu_set_irq_callback(cputag_get_cpu(machine, "maincpu"), mod8_irq_callback);
	tty_clear();
}

static VIDEO_START( mod8 )
{
	
}

static VIDEO_UPDATE( mod8 )
{
	UINT8 code;
	int y, c, x, b;

	for (y = 0; y < 25; y++)
	{
		for (c = 0; c < 8; c++) 
		{
			int horpos = 0;
			for (x = 0; x < 80; x++)
			{			
				code = teleprinter_font[(tty_buffer[y*80 + x] & 0x7f)*8 + c];
				for (b = 0; b < 8; b++)
				{
					*BITMAP_ADDR16(bitmap, y*8 + c, horpos++) =  (code >> b) & 0x01 ? 0 : 1;
				}
			}
		}
	}
	return 0;
}

static MACHINE_DRIVER_START( mod8 )
    /* basic machine hardware */
    MDRV_CPU_ADD("maincpu",I8008, 800000)
    MDRV_CPU_PROGRAM_MAP(mod8_mem)
    MDRV_CPU_IO_MAP(mod8_io)

    MDRV_MACHINE_RESET(mod8)

    /* video hardware */
    MDRV_SCREEN_ADD("screen", RASTER)
    MDRV_SCREEN_REFRESH_RATE(50)
    MDRV_SCREEN_VBLANK_TIME(ATTOSECONDS_IN_USEC(2500)) /* not accurate */
    MDRV_SCREEN_FORMAT(BITMAP_FORMAT_INDEXED16)
    MDRV_SCREEN_SIZE(8*80, 25*8)
    MDRV_SCREEN_VISIBLE_AREA(0, 8*80-1, 0, 25*8-1)
    MDRV_PALETTE_LENGTH(2)
    MDRV_PALETTE_INIT(black_and_white)

    MDRV_VIDEO_START(mod8)
    MDRV_VIDEO_UPDATE(mod8)
MACHINE_DRIVER_END


/* ROM definition */
ROM_START( mod8 )
    ROM_REGION( 0x10000, "maincpu", ROMREGION_ERASEFF )
	ROM_LOAD( "mon8.001", 0x0000, 0x0100, CRC(b82ac6b8) SHA1(fbea5a6dd4c779ca1671d84089f857a3f548ffcb))
	ROM_LOAD( "mon8.002", 0x0100, 0x0100, CRC(8b82bc3c) SHA1(66222511527b27e56a5a1f9656d424d407eac7d3))
	ROM_LOAD( "mon8.003", 0x0200, 0x0100, CRC(679ae913) SHA1(22423efcb9051c9812fcbac9a27af70415d0dd81))
	ROM_LOAD( "mon8.004", 0x0300, 0x0100, CRC(2a4e580f) SHA1(8b0cb9660fde3cacd299faaa31724e4f3262d77f))
	ROM_LOAD( "mon8.005", 0x0400, 0x0100, CRC(e281bb1a) SHA1(cc7c2746e075512dbf5eed88ae3aea009558dbd0))
	ROM_LOAD( "mon8.006", 0x0500, 0x0100, CRC(b7e2f585) SHA1(5408adabc3df6e6ea8dcfb2327b2883b435ab85e))
	ROM_LOAD( "mon8.007", 0x0600, 0x0100, CRC(49a5c626) SHA1(66c1865db9151818d3b20ec3c68dd793cb98a221))
ROM_END

/* Driver */

/*    YEAR  NAME    PARENT  COMPAT   MACHINE    INPUT    INIT    CONFIG COMPANY   FULLNAME       FLAGS */
COMP( 1974, mod8,   0,       0, 		mod8, 	mod8, 	 0,  	  0,  	"Microsystems International Ltd.",   "MOD-8",		GAME_NOT_WORKING)

